<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"/>

<style>
.password-verdict{
color:#000;
}
</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" th:href="@{/css/floating-labels.css}"/>
<link rel="stylesheet" type="text/css" th:href="@{/css/registration.css}"/>
<link rel="stylesheet" type="text/css" th:href="@{/css/footer.css}"/>

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.8/css/select2.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.8/js/select2.min.js"></script>

<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII"/>
<title th:text="#{label.form.title}">form</title>
</head>

<body>
    <div class="preload">
			<div class="top-banner">
			    <img class="logo-white" th:src="@{/img/logo_white.png}"/>
					<h1 class="title-label" th:text="#{label.form.title}">form</h1>
			</div>

			<div class="content">	
					<div>
							<form action="/" method="POST" enctype="utf8" >
							<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

									<div class="info-box" id="basic-info-box" >
											<div class="form-group row">
												<p id="form-title" class="col-sm-8" th:text="#{label.form.register}">form</p>
											</div>

											<div class="row-container row">
												<div class="form-label-group short-label">
													<input type="text" id="firstName" class="form-control input-lg" placeholder="#{label.user.firstName}" name="firstName" value="" required>
													<label for="firstName" th:text="#{label.user.firstName}">first</label>
												</div>

												<div class="form-label-group short-label">
													<input type="text" id="lastName" class="form-control input-lg" placeholder="#{label.user.lastName}" name="lastName" value="" required>
													<label for="lastName" th:text="#{label.user.lastName}">Last</label>
												</div>
											</div>

											<div class="row">
												<span id="userNameError" class="form-alert" style="display:none"></span>
											</div>

											<div class="row-container row ">
												<div class="form-label-group long-label" >
													<input type="text" id="email" class="form-control input-lg" placeholder="#{label.user.email}" name="email" value="" required>
													<label for="email" th:text="#{label.user.email}">email</label>
												</div>													
											</div>

											<div class="row">
												<span id="emailError" class="form-alert" style="display:none"></span>
											</div>

											<div class="row-container row ">
												<div class="form-label-group long-label" >
													<input type="text" id="telephone" class="form-control input-lg" placeholder="#{label.user.telephone}" name="telephone" value="" required>
													<label for="telephone" th:text="#{label.user.telephone}">telephone</label>
												</div>													
											</div>

											<div class="row">
												<span id="telephoneError" class="form-alert" style="display:none"></span>
											</div>

											<div class="row-container row">
												<div class="form-label-group short-label">
													<input type="password" id="password" class="form-control input-lg" placeholder="#{label.user.password}" name="password" value="" required>
													<label for="password" th:text="#{label.user.password}">password</label>
												</div>

												<div class="form-label-group short-label">
													<input type="password" id="matchPassword" class="form-control input-lg" placeholder="#{label.user.confirmPass}" name="matchingPassword" value="" required>
													<label for="matchPassword" th:text="#{label.user.confirmPass}">Last</label>
												</div>
											</div>

											<div class="row">
												<span id="passwordHint" class="hint-password" th:text="#{error.password.rule}"></span>
											</div>

											<div class="row">
												<span id="passwordError" class="form-alert" style="display:none"></span>
											</div>
											
											<div class="row-container row ">
												<div class="form-label-group long-label">
													<input type="text" id="organization" class="form-control input-lg" placeholder="#{label.user.organization}" name="organization" value="" required readonly>
													<label for="organization" th:text="#{label.user.organization}">organization</label>
												</div>													
											</div>

											<div class="row">
												<span id="organizationError" class="form-alert" style="display:none">1</span>
											</div>

											<div class="row-container row ">
												<div class="form-label-group long-label">
													<input type="text" id="department" class="form-control input-lg" placeholder="#{label.user.department}" name="department" value="">
													<label for="department" th:text="#{label.user.department}">department</label>
												</div>
												<button id="sign-up-continue" type="button" class="btn btn-primary" th:text="#{label.form.continue}">continue</button>
											</div>
									</div>


									<div class="info-box" id="research-info-box" style="display: none;">
										<div class="form-group row">
											<p id="form-title" class="col-sm-12" th:text="#{label.form.research}"></p>
										</div>

										<div class="form-group row">
											<p id="shipping-desc" class="col-sm-8" th:text="#{label.form.research.desc}"></p>
										</div>

										<div class="row-container row ">
											<div class="form-label-group long-label">
												<input type="text" id="research-field" class="form-control input-lg" placeholder="#{label.form.research.field}" name="researchField" value="" autocomplete="rutjfkde">
												<label for="research-field" th:text="#{label.form.research.field}"></label>
											</div>													
										</div>

										<div class="row-container row ">
											<div class="form-label-group long-label">
												<input type="text" id="research-method" class="form-control input-lg" placeholder="#{label.form.research.method}" name="researchMethod" value="" autocomplete="rutjfkde">
												<label for="research-method" th:text="#{label.form.research.method}"></label>
											</div>													
										</div>

										<div class="row-container row coordinate-row">
											<select multiple id="research-coordinate-team" name="coordinateTeams">
													<option value="Github">Github</option>
													<option value="Markdown">Markdown</option>
													<option value="Slack">Slack</option>
													<option value="KEEPER">KEEPER</option>
													<option value="Mattermost">Mattermost</option>
													<option value="WhatsApp">WhatsApp</option>
													<option value="Trello">Trello</option>
											</select>
										</div>

										<div class="row-container row" style="margin-top: 10px;" >
											<button id="continue-to-address" type="button" class="btn btn-primary" th:text="#{label.form.continue}">continue</button>
										</div>

									</div>

									<div class="info-box" id="address-info-box" style="display: none;">
										<div class="form-group row">
											<p id="form-title" class="col-sm-8" th:text="#{label.form.shipping}"></p>
										</div>

										<div class="row-container row ">
											<div class="form-label-group long-label">
												<input type="text" id="address" class="form-control input-lg" placeholder="#{label.user.address}" name="address" value="" autocomplete="rutjfkde">
												<label for="address" th:text="#{label.user.address}">address</label>
											</div>													
										</div>

										<div class="row-container row">
											<div class="form-label-group short-label">
												<input type="text" id="city" class="form-control input-lg" placeholder="#{label.user.city}" name="city" value="" autocomplete="rutjfkde">
												<label for="city" th:text="#{label.user.city}">city</label>
											</div>

											<div class="form-label-group short-label">
												<input type="text" id="country" class="form-control input-lg" placeholder="#{label.user.country}" name="country" value="" autocomplete="rutjfkde">
												<label for="country" th:text="#{label.user.country}">country</label>
											</div>

											<div class="form-label-group short-label">
												<input type="text" id="zip" class="form-control input-lg" placeholder="#{label.user.zipcode}" name="zip" value="" autocomplete="rutjfkde">
												<label for="zip" th:text="#{label.user.zipcode}"></label>
											</div>
										</div>

										<div id="accept-and-sign-up">
											<div id="mpad-checkboxes">
												<div class="checkbox">
													<label><input type="checkbox" id="mattermostCheckbox" name="mattermost" value="true">I require a Mattermost account.</label>
												</div>
												<div class="checkbox">
													<label><input type="checkbox" id="termCheckbox" value="">I accept the <a href="https://www.mpdl.mpg.de/terms-of-service-de.html" target="_blank"><u>Terms of Service</u><a/></label>
												</div>
											</div>
											<button id='btn-mpad-register' type="submit" class="btn btn-primary" th:text="#{label.form.register}">submit</button>
										</div>

										<div class="form-group row">
											<span id="termsError" class="form-alert" style="display:none"></span>
										</div>	
									</div>

							</form>
							<br/> 
					</div>
			</div>
		</div>

<script th:inline="javascript">

$("#research-coordinate-team").select2({
	placeholder: /*[[#{label.form.research.coordinate}]]*/,
	tags: true,
	dropdownAutoWidth: true
});

var serverContext = [[@{/}]];

var departments = {
		"biblhertz.it":"Bibliotheca Hertziana - Max-Planck-Institutfür Kunstgeschichte",
		"dkrz.de":"Deutsches Klimarechenzentrum",
		"esi-frankfurt.de":"Ernst Strüngmann Institute (ESI) forNeuroscience in Cooperation with Max-Planck-Society",
		"caesar.de":"Forschungszentrum caesar (center ofadvanced european studies and research)",
		"tuebingen.mpg.de":"Friedrich-Miescher-Laboratorium fürbiologische Arbeitsgruppen in der Max-Planck-Gesellschaft",
		"fhi-berlin.mpg.de":"Fritz-Haber-Institut der Max-Planck-Gesellschaft",
		"gv.mpg.de":"Generalverwaltung",
		"gwdg.de":"GWD Göttingen",
		"hll.mpg.de":"Halbleiterlabor der Max-Planck-Gesellschaft",
		"hda-hd.de":"Haus der Astronomie",
		"khi.fi.it":"Kunsthistorisches Institut in Florenz - Max-Planck-Institut",
		"mpcdf.mpg.de":"Max Planck Computing and Data Facility",
		"rzg.mpg.de":"Max Planck Computing and Data Facility",
		"mpdl.mpg.de":"Max Planck Digital Library",
		"maxplanckflorida.org":"Max Planck Florida Institute for Neuroscience",
		"mpfi.org":"Max Planck Florida Institute for Neuroscience",
		"mpfpr.de":"Max Planck Foundation for InternationalPeace and the Rule of Law",
		"gen.mpg.de":"Max-Planck-Forschungsstelle für Neurogenetik",
		"mpi.lu":"Max Planck Institute Luxembourg forInternational, European and RegulatoryProcedural Law",
		"mpia.de":"Max-Planck-Institut für Astronomie",
		"mpia-hd.de":"Max-Planck-Institut für Astronomie",
		"mpa-garching.mpg.de":"Max-Planck-Institut für Astrophysik",
		"mpil.de":"Max-Planck-Institut für ausländischesöffentliches Recht und Völkerrecht",
		"mpipriv.de":"Max-Planck-Institut für ausländisches undinternationales Privatrecht",
		"mpicc.de":"Max-Planck-Institut für ausländisches undinternationales Strafrecht",
		"mpib-berlin.mpg.de":"Max-Planck-Institut für Bildungsforschung",
		"biochem.mpg.de":"Max-Planck-Institut für Biochemie",
		"bgc-jena.mpg.de":"Max-Planck-Institut für Biogeochemie",
		"age.mpg.de":"Max-Planck-Institut für Biologie des Alterns",
		"tuebingen.mpg.de":"Max-Planck-Institut für biologischeKybernetik",
		"mpibp-frankfurt.mpg.de":"Max-Planck-Institut für Biophysik",
		"biophys.mpg.de":"Max-Planck-Institut für Biophysik",
		"mpibpc.mpg.de":"Max-Planck-Institut für biophysikalischeChemie",
		"mpic.de":"Max-Planck-Institut für Chemie",
		"cec.mpg.de":"Max-Planck-Institut für chemischeEnergiekonversion",
		"ice.mpg.de":"Max-Planck-Institut für chemische Ökologie",
		"cpfs.mpg.de":"Max-Planck-Institut für Chemische Physikfester Stoffe",
		"demogr.mpg.de":"Max-Planck-Institut für demografischeForschung",
		"mpl.mpg.de":"Max-Planck-Institut für die Physik des Lichts",
		"mpi-magdeburg.mpg.de":"Max-Planck-Institut für Dynamik komplexertechnischer Systeme",
		"ds.mpg.de":"Max-Planck-Institut für Dynamik undSelbstorganisation",
		"mpie.de":"Max-Planck-Institut für Eisenforschung GmbH",
		"aesthetics.mpg.de":"Max-Planck-Institut für empirische Ästhetik",
		"tuebingen.mpg.de":"Max-Planck-Institut für Entwicklungsbiologie",
		"eth.mpg.de":"Max-Planck-Institut für ethnologische Forschung",
		"mpier.uni-frankfurt.de":"Max-Planck-Institut für europäischeRechtsgeschichte",
		"rg.mpg.de":"Max-Planck-Institut für europäischeRechtsgeschichte",
		"eva.mpg.de":"Max-Planck-Institut für evolutionäreAnthropologie",
		"evolbio.mpg.de":"Max-Planck-Institut für Evolutionsbiologie",
		"em.mpg.de":"Max-Planck-Institut für experimentelle Medizin",
		"mpe.mpg.de":"Max-Planck-Institut für extraterrestrische Physik",
		"fkf.mpg.de":"Max-Planck-Institut für Festkörperforschung",
		"mpifg.de":"Max-Planck-Institut für Gesellschaftsforschung",
		"aei.mpg.de":"Max-Planck-Institut für Gravitationsphysik",
		"!!aei.mpg.de":"Max-Planck-Institut für Gravitationsphysik, Teilinstitut Hannover",
		"kerckhoff.mpg.de":"Max-Planck-Institut für Herz- undLungenforschung",
		"mpi-bn.mpg.de":"Max-Planck-Institut für Herz- undLungenforschung",
		"mpih-frankfurt.mpg.de":"Max-Planck-Institut für Hirnforschung",
		"brain.mpg.de":"Max-Planck-Institut für Hirnforschung",
		"immunbio.mpg.de":"Max-Planck-Institut für Immunbiologie",
		"ie-freiburg.mpg.de":"Max-Planck-Institut für Immunbiologie und Epigenetik",
		"mpiib-berlin.mpg.de":"Max-Planck-Institut für Infektionsbiologie",
		"mpi-inf.mpg.de":"Max-Planck-Institut für Informatik",
		"mpi-klsb.mpg.de":"Max-Planck-Institut für Informatik",
		"ip.mpg.de":"Max-Planck-Institut für Innovation undWettbewerb",
		"is.mpg.de":"Max-Planck-Institut für Intelligente Systeme,Standort Stuttgart",
		"tuebingen.mpg.de":"Max-Planck-Institut für Intelligente Systeme,Standort Tübingen",
		"mpi-hd.mpg.de":"Max-Planck-Institut für Kernphysik",
		"cbs.mpg.de":"Max-Planck-Institut für Kognitions- und Neurowissenschaften",
		"kofo.mpg.de":"Max-Planck-Institut für Kohlenforschung",
		"mpikg-golm.mpg.de":"Max-Planck-Institut für Kolloid- und Grenzflächenforschung",
		"mpikg.mpg.de":"Max-Planck-Institut für Kolloid- und Grenzflächenforschung",
		"mpil-ploen.mpg.de":"Max-Planck-Institut für Limnologie",
		"mpi-bremen.de":"Max-Planck-Institut für marine Mikrobiologie",
		"mpim-bonn.mpg.de":"Max-Planck-Institut für Mathematik",
		"mis.mpg.de":"Max-Planck-Institut für Mathematik in den Naturwissenschaften",
		"mpimf-heidelberg.mpg.de":"Max-Planck-Institut für medizinische Forschung",
		"shh.mpg.de":"Max-Planck-Institut für Menschheitsgeschichte",
		"zmaw.de":"Max-Planck-Institut für Meteorologie",
		"mpimet.mpg.de":"Max-Planck-Institut für Meteorologie",
		"mpi-halle.mpg.de":"Max-Planck-Institut für Mikrostrukturphysik",
		"mpi-halle.de":"Max-Planck-Institut für Mikrostrukturphysik",
		"mpi-muenster.mpg.de":"Max-Planck-Institut für molekulare Biomedizin",
		"molgen.mpg.de":"Max-Planck-Institut für molekulare Genetik",
		"mpimp-golm.mpg.de":"Max-Planck-Institut für molekulare Pflanzenphysiologie",
		"cgc.mpg.de":"Max-Planck-Institut für molekulare Physiologie",
		"mpi-dortmund.mpg.de":"Max-Planck-Institut für molekulare Physiologie",
		"mpi-cbg.de":"Max-Planck-Institut für molekulare Zellbiologie und Genetik",
		"neuro.mpg.de":"Max-Planck-Institut für Neurobiologie",
		"nf.mpg.de":"Max-Planck-Institut für neurologische Forschung",
		"econ.mpg.de":"Max-Planck-Institut für Ökonomik",
		"orn.mpg.de":"Max-Planck-Institut für Ornithologie",
		"!!orn.mpg.de":"Max-Planck-Institut für Ornithologie, Teilinstitut Radolfzell",
		"mpipz.mpg.de":"Max-Planck-Institut für Pflanzenzüchtungsforschung",
		"mpiz-koeln.mpg.de":"Max-Planck-Institut für Pflanzenzüchtungsforschung",
		"mppmu.mpg.de":"Max-Planck-Institut für Physik",
		"mpp.mpg.de":"Max-Planck-Institut für Physik",
		"pks.mpg.de":"Max-Planck-Institut für Physik komplexer Systeme",
		"mpipks-dresden.mpg.de":"Max-Planck-Institut für Physik komplexer Systeme",
		"ipp.mpg.de":"Max-Planck-Institut für Plasmaphysik",
		"!!ipp.mpg.de":"Max-Planck-Institut für Plasmaphysik, Teilinstitut Greifswald",
		"mpip-mainz.mpg.de":"Max-Planck-Institut für Polymerforschung",
		"mpipsykl.mpg.de":"Max-Planck-Institut für Psychiatrie",
		"psych.mpg.de":"Max-Planck-Institut für Psychiatrie",
		"mpi.nl":"Max-Planck-Institut für Psycholinguistik",
		"mpq.mpg.de":"Max-Planck-Institut für Quantenoptik",
		"mpifr.de":"Max-Planck-Institut für Radioastronomie",
		"mpifr-bonn.mpg.de":"Max-Planck-Institut für Radioastronomie",
		"mpi-sws.or":"Max-Planck-Institut für Softwaresysteme, Standort Kaiserslautern",
		"mpi-klsb.mpg.de":"Max-Planck-Institut für Softwaresysteme, Standort Kaiserslautern",
		"!!mpi-klsb.mpg.de":"Max-Planck-Institut für Softwaresysteme, Standort Saarbrücken",
		"mps.mpg.de":"Max-Planck-Institut für Sonnensystemforschung",
		"mpisoc.mpg.de":"Max-Planck-Institut für Sozialrecht und Sozialpolitik",
		"tax.mpg.de":"Max-Planck-Institut für Steuerrecht und Öffentliche Finanzen",
		"sf.mpg.de":"Max-Planck-Institut für Stoffwechselforschung",
		"mpsd.mpg.de":"Max-Planck-Institut für Struktur und Dynamik der Materie",
		"mpi-marburg.mpg.de":"Max-Planck-Institut für terrestrische Mikrobiologie",
		"mpiwg-berlin.mpg.de":"Max-Planck-Institut für Wissenschaftsgeschichte",
		"mmg.mpg.de":"Max-Planck-Institut zur Erforschung multireligiöser und multiethnischer Gesellschaften",
		"coll.mpg.de":"Max-Planck-Institut zur Erforschung von Gemeinschaftsgütern",
		"mpi-muelheim.mpg.de":"Mülheimer Institute",
		"mpis.mpg.de":"Stuttgarter Institute",
}


$(document).ready(function () {
	$('.info').children().first().hide()  //fix: strange styling link element 

	$('#sign-up-continue').click(function(event) {
		continue_register(event);
	});

	$('#continue-to-address').click(function(event) {
		$('#research-info-box').hide();
		$('#address-info-box').show();
	});

	$('form').submit(function(event) {
		register(event);
	});

	$("#firstName").focus(function(){
		$("#userNameError").html("").hide();
	});

	$("#lastName").focus(function(){
		$("#userNameError").html("").hide();
	});

	$("#email").focus(function(){
			$("#emailError").html("").hide();
			$("#organizationError").html("").hide();
	});
	
	$("#email").focusout(function(){
			var email = $("#email").val();
			var department_id = email.substring(email.indexOf('@')+1);
			if (email.trim().indexOf('@') === 0) {
				$("#emailError").show().html("Invalid email");
			}
			if (departments[department_id]) {
				$("#organization").val(departments[department_id]);
			} else {
				$("#organizationError").show().html(/*[[#{EmailMatches.org}]]*/);
				$("#organization").val('');
			}
	});

	$("#telephone").focus(function(){
		$("#telephoneError").html("").hide();
	});
	
	$("#matchPassword").focus(function(){
		$("#passwordError").html("").hide();
	});

	$("#password").focus(function(){
		$("#passwordError").html("").hide();
	});
});

function continue_register(event) {
		if ($('#firstName').val().length <= 0) {
			$('#userNameError').show().html("Please fill in your first name");
		}	else if ($('#lastName').val().length <= 0) {
			$('#userNameError').show().html("Please fill in your last name");
		} else if ($('#email').val().length <= 0){
			$('#emailError').show().html("Please fill in your email");
		}else if ($('#telephone').val().length <= 0){
			$('#telephoneError').show().html("Please fill in your telephone");
		}	else if ($('#organization').val().length <= 0) {
			$("#organizationError").show().html(/*[[#{EmailMatches.org}]]*/);
		} else if ($('#password').val().length <= 0 || $('#matchPassword').val().length <= 0) {
			$("#passwordError").show().html("Please fill in your password");
			$("#passwordHint").hide();
		} else if ($('#password').val() !== $('#matchPassword').val()) {
			$("#passwordError").show().html(/*[[#{PasswordMatches.user}]]*/);
			$("#passwordHint").hide();
		} else if ($('#password').val().length < 6) {
			$("#passwordError").show().html(/*[[#{error.password.rule}]]*/);
			$("#passwordHint").hide();
		} else {
			$('#basic-info-box').hide();
			$('#research-info-box').show();
		}
}

function register(event){
	event.preventDefault();
	var accepted = $("input:checked").length
	if (!accepted) {
		$("#termsError").show().html(/*[[#{Checked.terms}]]*/);
		 return;
	};
	
	$(".alert").html("").hide();
	$(".error-list").html("");
	if($("#password").val() != $("#matchPassword").val()){
		$("#passwordError").show().html(/*[[#{PasswordMatches.user}]]*/);
		$("#passwordHint").hide();
		return;
	}
			
	var formData= $('form').serialize();
	$.post(serverContext + "user/registration",formData ,function(data){
			if(data.message == "success"){
					window.location.href = serverContext + "successRegister.html";
			}
			
	})
	.fail(function(data) {
			if(data.responseJSON.error.indexOf("MailError") > -1)
			{
					window.location.href = serverContext + "emailError.html";
			}
			else if(data.responseJSON.error == "UserAlreadyExist"){
					$("#termsError").show().html(data.responseJSON.message);
			}
			else if(data.responseJSON.error.indexOf("InternalError") > -1){
					window.location.href = serverContext + "login?message=" + data.responseJSON.message;
			}
			else{
				var errors = $.parseJSON(data.responseJSON.message);
					$.each( errors, function( index,item ){
						console.log(item.defaultMessage);
						if (item.field){
							//$("#"+item.field+"Error").show().append(item.defaultMessage+"<br/>");
							$("#termsError").show().append(item.defaultMessage+"<br/>");
						}
						else {
							$("#termsError").show().append(item.defaultMessage+"<br/>");
						}
					});
			}
    });
}

</script>
</body>

</html>
